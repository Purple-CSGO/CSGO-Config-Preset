// Tutorial Article https://upup.cool/pages/620156/
// Totorial Video [With English CC Subtitle] https://b23.tv/av56424646
// Auto-Download&Install&Update Tool [HLAE Studio] https://github.com/One-Studio/HLAE-Studio
// 1.Install FFmpeg to ".\hlae\ffmpeg"
//   If you are using CSGO Demos Manager：%USERNAME%\AppData\Local\AkiVer\hlae\ffmpeg"
// 2.Use preset commands to change record settings i.e. p0 p1 p2
// 3.Default preset is p2 [Trade-off between quality and filesize/bitrate]
// 4.Pls use VLC、Potplayer to playback. It's quite common if you have stutter when playback

engine_no_focus_sleep 0	//make sure there's no frame drop when csgo is not selected/focused

//Remove presets
alias allclear "tga;mirv_streams settings remove p422;mirv_streams settings remove p4444;mirv_streams settings remove p0pro;mirv_streams settings remove p0;mirv_streams settings remove p1pro;mirv_streams settings remove p2pro;mirv_streams settings remove p3pro;mirv_streams settings remove p1;mirv_streams settings remove p2;mirv_streams settings remove p3;"

//Define presets
mirv_streams settings add ffmpeg p422   "-c:v prores  -profile:v 2 -pix_fmt yuv422p10le {QUOTE}{AFX_STREAM_PATH}.mov{QUOTE}"
mirv_streams settings add ffmpeg p4444  "-c:v prores  -profile:v 4 {QUOTE}{AFX_STREAM_PATH}.mov{QUOTE}"
mirv_streams settings add ffmpeg p0pro  "-c:v libx264 -preset ultrafast -qp 0   -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv422p10le {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p0     "-c:v libx264 -preset ultrafast -qp 0   -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv420p {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p1pro  "-c:v libx264 -preset veryfast  -crf 2  -qmax 20 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv422p10le -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p2pro  "-c:v libx264 -preset veryfast  -crf 10 -qmax 30 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv422p10le -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p3pro  "-c:v libx264 -preset veryfast  -crf 18 -qmax 40 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv422p10le -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p1     "-c:v libx264 -preset veryfast  -crf 2  -qmax 20 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv420p -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p2     "-c:v libx264 -preset veryfast  -crf 10 -qmax 30 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv420p -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"
mirv_streams settings add ffmpeg p3     "-c:v libx264 -preset veryfast  -crf 18 -qmax 40 -g 2400 -keyint_min 2400 -rc-lookahead 1200 -pix_fmt yuv420p -x264-params ref=3:me=hex:subme=3:merange=12:b-adapt=1:aq-mode=2:aq-strength=0.9:no-fast-pskip=1 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}"

//Define fast preset commands
mirv_exec alias tga    "mirv_streams settings edit afxDefault settings afxClassic;echo;echo {QUOTE}Current Record Setting: afxClassic - lossless TGA sequence{QUOTE};echo;";
mirv_exec alias p422   "mirv_streams settings edit afxDefault settings p422  ;echo;echo {QUOTE}Current Record Setting: Prores 422{QUOTE};echo;";
mirv_exec alias p4444  "mirv_streams settings edit afxDefault settings p4444 ;echo;echo {QUOTE}Current Record Setting: Prores 4444{QUOTE};echo;";
mirv_exec alias p0pro "mirv_streams settings edit afxDefault settings p0pro;echo;echo {QUOTE}Current Record Setting: p0pro{QUOTE};echo;";
mirv_exec alias p0    "mirv_streams settings edit afxDefault settings p0   ;echo;echo {QUOTE}Current Record Setting: p0   {QUOTE};echo;";
mirv_exec alias p1pro  "mirv_streams settings edit afxDefault settings p1pro ;echo;echo {QUOTE}Current Record Setting: p1pro {QUOTE};echo;";
mirv_exec alias p2pro  "mirv_streams settings edit afxDefault settings p2pro ;echo;echo {QUOTE}Current Record Setting: p2pro {QUOTE};echo;";
mirv_exec alias p3pro  "mirv_streams settings edit afxDefault settings p3pro ;echo;echo {QUOTE}Current Record Setting: p3pro {QUOTE};echo;";
mirv_exec alias p1     "mirv_streams settings edit afxDefault settings p1    ;echo;echo {QUOTE}Current Record Setting: p1    {QUOTE};echo;";
mirv_exec alias p2     "mirv_streams settings edit afxDefault settings p2    ;echo;echo {QUOTE}Current Record Setting: p2    {QUOTE};echo;";
mirv_exec alias p3     "mirv_streams settings edit afxDefault settings p3    ;echo;echo {QUOTE}Current Record Setting: p3    {QUOTE};echo;";

//Print to console
echo "─────────────────────────────────────────"
echo "1.Pls install HLAE&FFmpeg correctly"
echo "2.Do set host_framerate > 0"
echo "3.Use this before exec again: allclear"
echo "4.Test environment: 1920x1080 300FPS"
echo "5.yuv422p10le <- 10bit but less compatible"
echo "────────────┬─────────────┬──────────────"
echo "   Commands |    10bit    |    Bitrate≈  "
echo "────────────┼─────────────┼──────────────"
echo "    tga     |             |   104GB/min  "
echo "    p4444   |             |    27GB/min  "
echo "    p422    |             |    10GB/min  "
echo "    p0      |    p0pro    |    17GB/min  "
echo "    p1      |    p1pro    |     4GB/min  "
echo "    p2      |    p2pro    |     2GB/min  "
echo "    p3      |    p3pro    |   400MB/min  "
echo "────────────┴─────────────┴──────────────"

//Set default preset. Change if you want to
p2;

